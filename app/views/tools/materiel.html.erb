<% title(t('tools.materiel.title')) %>
<% description("Track your character's progress by Materiel Container.") %>

<%= render 'shared/filters' %>
<div class="d-flex justify-contenter-center mb-2">
  <%= button_tag fa_icon('filter', text: t('filters')), data: { toggle: 'modal', target: '#filters'},
    type: 'button', class: 'btn btn-secondary btn-sm modal-toggle ml-auto' %>
</div>
<div class="row">
  <% @containers.each do |number, collectables| %>
    <div class="col-12 col-xl-6 mb-4">
      <div class="card shadow">
        <div class="card-header">
          <h5 class="card-title">
            <%= fa_icon('box') %>
            <%= t("tools.materiel.container.#{number}") %>
          </h5>
        </div>
        <div class="card-body materiel-progress">
          <%= render 'shared/progress', value: (collectables[:mounts].map(&:id) & @ids[:mounts]).size,
            min: 0, max: collectables[:mounts].length, text: 'mounts.title' %>
          <%= render 'shared/progress', value: (collectables[:minions].map(&:id) & @ids[:minions]).size,
            min: 0, max: collectables[:minions].length, text: 'minions.title', alt: true %>
        </div>
      </div>
      <table class="table table-striped table-sm shadow collection fill sortable materiel mt-3">
        <thead>
          <tr>
            <th scope="col">#</th> <!-- Image -->
            <th scope="col"><%= t('name') %></th>
            <th scope="col" class="text-center"><%= fa_icon('dollar-sign') %></th>
            <th scope="col" class="text-center"><%= t('patch') %></th>
            <th scope="col"></th><!-- Owned -->
          </tr>
        </thead>
        <tbody>
          <% collectables.each do |type, collection| %>
            <% collection.each do |collectable| %>
              <tr class="collectable<%= ' owned' if @ids[type].include?(collectable.id) %>">
                <td><%= collectable_image(collectable) %></td>
                <td><%= collectable_name_link(collectable) %></td>
                <td class="text-center" data-value="<%= price_sort_value(collectable) %>"><%= market_link(collectable) %></td>
                <td class="text-center"><%= collectable.patch %></td>
                <td>
                  <%= fa_icon(@ids[type].include?(collectable.id) ? 'check' : 'times', class: 'text-center') %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
